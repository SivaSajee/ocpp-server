<!DOCTYPE html>
<html>
<head>
<title>PROJECT_EXPLANATION.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="ocpp-ev-charging-server-with-dynamic-load-balancing">OCPP EV Charging Server with Dynamic Load Balancing</h1>
<h2 id="project-overview">Project Overview</h2>
<p>This is a <strong>full-stack EV charging management system</strong> that implements the OCPP 1.6 protocol with advanced Dynamic Load Balancing (DLB) capabilities. The system enables intelligent power distribution across multiple EV chargers while optimizing solar energy usage and preventing grid overload.</p>
<hr>
<h2 id="%F0%9F%8E%AF-key-features">ğŸ¯ Key Features</h2>
<h3 id="1-ocpp-16-protocol-implementation">1. <strong>OCPP 1.6 Protocol Implementation</strong></h3>
<ul>
<li>Full WebSocket-based communication with EV chargers</li>
<li>Remote start/stop charging control</li>
<li>Real-time meter value monitoring (voltage, current, power, energy)</li>
<li>Transaction management with session tracking</li>
<li>Status notifications and heartbeat monitoring</li>
</ul>
<h3 id="2-dynamic-load-balancing-dlb-system">2. <strong>Dynamic Load Balancing (DLB) System</strong></h3>
<p>Four intelligent charging modes:</p>
<ul>
<li><strong>PV Dynamic Balance</strong>: Prioritizes solar energy consumption, adjusts charging based on grid import/export</li>
<li><strong>Extreme Mode</strong>: Maximum power charging (32A) regardless of conditions</li>
<li><strong>Night Full Speed</strong>: Automatic full-speed charging during off-peak hours (22:00-06:00)</li>
<li><strong>Anti Overload</strong>: Safety mechanism preventing main fuse overload (60A limit)</li>
</ul>
<h3 id="3-real-time-dashboard">3. <strong>Real-Time Dashboard</strong></h3>
<ul>
<li>Live charger status monitoring</li>
<li>Power flow visualization with animated indicators</li>
<li>Interactive DLB controls with toggle switches</li>
<li>Charging history with daily/monthly/yearly views</li>
<li>Multi-charger support with device list</li>
</ul>
<h3 id="4-data-persistence">4. <strong>Data Persistence</strong></h3>
<ul>
<li>MongoDB integration for session history</li>
<li>IST timezone support for Indian users</li>
<li>Energy consumption tracking and reporting</li>
</ul>
<hr>
<h2 id="%F0%9F%8F%97%EF%B8%8F-system-architecture">ğŸ—ï¸ System Architecture</h2>
<pre class="hljs"><code><div>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EV Chargers   â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚   OCPP Server    â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚   Dashboard     â”‚
â”‚  (OCPP 1.6)     â”‚  WebSocket  â”‚   (Node.js)      â”‚  WebSocket  â”‚   (Web UI)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    MongoDB       â”‚
                            â”‚  (Session Data)  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</div></code></pre>
<h3 id="components">Components:</h3>
<ol>
<li>
<p><strong>server.js</strong> (Core OCPP Server)</p>
<ul>
<li>WebSocket server for charger communication</li>
<li>HTTP server for dashboard and API</li>
<li>DLB calculation engine</li>
<li>Transaction management</li>
</ul>
</li>
<li>
<p><strong>dashboard.html</strong> (Web Interface)</p>
<ul>
<li>Real-time charger monitoring</li>
<li>DLB visualization with power flow animation</li>
<li>History charts and statistics</li>
<li>Remote control interface</li>
</ul>
</li>
<li>
<p><strong>database.js</strong> (Data Layer)</p>
<ul>
<li>MongoDB connection management</li>
<li>Session CRUD operations</li>
<li>Period-based data queries</li>
</ul>
</li>
<li>
<p><strong>charger-simulator.js</strong> (Testing Tool)</p>
<ul>
<li>Simulates OCPP 1.6 chargers</li>
<li>Generates realistic meter values</li>
<li>Simulates DLB sensor data (Grid, PV, Home load)</li>
</ul>
</li>
</ol>
<hr>
<h2 id="%E2%9A%A1-dynamic-load-balancing-logic">âš¡ Dynamic Load Balancing Logic</h2>
<h3 id="power-flow-calculation">Power Flow Calculation</h3>
<pre class="hljs"><code><div>Available Power = (Main Fuse Capacity - Home Load - Safety Margin)
Target Charging Current = f(Solar Power, Grid Power, Mode Settings)
</div></code></pre>
<h3 id="mode-priority-hierarchy">Mode Priority Hierarchy</h3>
<ol>
<li><strong>Extreme Mode</strong> (Highest) â†’ Always 32A</li>
<li><strong>Night Full Speed</strong> â†’ 32A during 22:00-06:00</li>
<li><strong>PV Dynamic Balance</strong> â†’ Adjusts based on solar excess</li>
<li><strong>Anti Overload</strong> (Safety Layer) â†’ Caps all modes to prevent overload</li>
</ol>
<h3 id="real-time-adjustment">Real-Time Adjustment</h3>
<ul>
<li>DLB recalculates every 10 seconds when meter values arrive</li>
<li>Sends <code>SetChargingProfile</code> OCPP command to charger</li>
<li>Adjusts power limit dynamically based on:
<ul>
<li>Grid import/export (positive = importing, negative = exporting)</li>
<li>Solar generation (0-10kW based on time of day)</li>
<li>Home consumption (3-8kW variable)</li>
<li>Active charging mode settings</li>
</ul>
</li>
</ul>
<hr>
<h2 id="%F0%9F%94%A7-technical-stack">ğŸ”§ Technical Stack</h2>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Technology</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backend</strong></td>
<td>Node.js, WebSocket (ws library)</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>MongoDB (Mongoose)</td>
</tr>
<tr>
<td><strong>Frontend</strong></td>
<td>Vanilla HTML/CSS/JavaScript</td>
</tr>
<tr>
<td><strong>Protocol</strong></td>
<td>OCPP 1.6 (JSON over WebSocket)</td>
</tr>
<tr>
<td><strong>Communication</strong></td>
<td>Bidirectional WebSocket (Server â†” Charger, Server â†” Dashboard)</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%93%8A-data-flow">ğŸ“Š Data Flow</h2>
<h3 id="charging-session-flow">Charging Session Flow</h3>
<pre class="hljs"><code><div>1. Charger connects â†’ BootNotification
2. Dashboard sends RemoteStartTransaction
3. Charger responds â†’ StartTransaction
4. Meter values sent every 10s â†’ MeterValues
5. DLB calculates optimal power â†’ SetChargingProfile
6. Dashboard sends RemoteStopTransaction
7. Charger responds â†’ StopTransaction
8. Session saved to MongoDB
</div></code></pre>
<h3 id="dlb-data-flow">DLB Data Flow</h3>
<pre class="hljs"><code><div>1. Charger sends MeterValues with DLB measurands:
   - Power.Active.Import.Grid (Grid power)
   - Power.Active.Import.PV (Solar power)
   - Power.Active.Import.Home (Home load)

2. Server calculates target charging current based on active modes

3. Server sends SetChargingProfile to charger with power limit

4. Server broadcasts DLB state to all dashboards via WebSocket

5. Dashboard updates power flow visualization
</div></code></pre>
<hr>
<h2 id="%F0%9F%8E%A8-dashboard-features">ğŸ¨ Dashboard Features</h2>
<h3 id="1-device-list-view">1. <strong>Device List View</strong></h3>
<ul>
<li>Shows all connected chargers</li>
<li>Real-time status (Online, Charging, Offline)</li>
<li>Current power, voltage, current readings</li>
<li>Session energy and duration</li>
</ul>
<h3 id="2-dlb-visualization">2. <strong>DLB Visualization</strong></h3>
<ul>
<li>Hub-and-spoke power flow diagram</li>
<li>Animated dots showing power direction</li>
<li>Real-time power values for Grid, PV, Charger, Home</li>
<li>Bidirectional grid flow (import/export)</li>
</ul>
<h3 id="3-history-view">3. <strong>History View</strong></h3>
<ul>
<li>Per-charger session history</li>
<li>Daily/Monthly/Yearly energy charts</li>
<li>Total energy consumption statistics</li>
<li>Session details (start/end time, duration, energy)</li>
</ul>
<h3 id="4-dlb-controls">4. <strong>DLB Controls</strong></h3>
<ul>
<li>Toggle switches for all 4 modes</li>
<li>Real-time mode updates across all dashboards</li>
<li>Visual feedback for active modes</li>
</ul>
<hr>
<h2 id="%F0%9F%A7%AA-testing--simulation">ğŸ§ª Testing &amp; Simulation</h2>
<h3 id="charger-simulator-features">Charger Simulator Features</h3>
<ul>
<li>Simulates OCPP 1.6 protocol messages</li>
<li>Generates realistic charging data:
<ul>
<li>Voltage: 230V Â± 5V</li>
<li>Current: 15-20A (when charging)</li>
<li>Power: Voltage Ã— Current</li>
</ul>
</li>
<li>Simulates time-based solar generation (peak at 10:00-14:00)</li>
<li>Variable home load (3-8kW)</li>
<li>Calculated grid import/export</li>
</ul>
<h3 id="testing-workflow">Testing Workflow</h3>
<ol>
<li>Start server: <code>npm start</code></li>
<li>Start simulator: <code>npm run simulator</code> or <code>node charger-simulator.js CP001</code></li>
<li>Open dashboard: <code>http://localhost:9000</code></li>
<li>Test remote start/stop</li>
<li>Toggle DLB modes and observe power adjustments</li>
</ol>
<hr>
<h2 id="%F0%9F%93%88-use-cases">ğŸ“ˆ Use Cases</h2>
<h3 id="1-solar-optimized-charging">1. <strong>Solar-Optimized Charging</strong></h3>
<ul>
<li>Maximizes self-consumption of solar energy</li>
<li>Reduces grid import costs</li>
<li>Automatically adjusts charging based on solar availability</li>
</ul>
<h3 id="2-multi-charger-management">2. <strong>Multi-Charger Management</strong></h3>
<ul>
<li>Supports multiple chargers simultaneously</li>
<li>Fair power distribution across chargers</li>
<li>Prevents total load from exceeding capacity</li>
</ul>
<h3 id="3-time-of-use-optimization">3. <strong>Time-of-Use Optimization</strong></h3>
<ul>
<li>Night Full Speed mode for cheap off-peak electricity</li>
<li>Automatic mode switching based on time</li>
</ul>
<h3 id="4-grid-safety">4. <strong>Grid Safety</strong></h3>
<ul>
<li>Anti Overload prevents circuit breaker trips</li>
<li>Real-time monitoring of total site load</li>
<li>Safety margins to account for load spikes</li>
</ul>
<hr>
<h2 id="%F0%9F%9A%80-deployment">ğŸš€ Deployment</h2>
<h3 id="local-development">Local Development</h3>
<pre class="hljs"><code><div>npm install
npm start
</div></code></pre>
<h3 id="production-considerations">Production Considerations</h3>
<ul>
<li>Use environment variables for MongoDB connection</li>
<li>Implement authentication for dashboard access</li>
<li>Add HTTPS/WSS for secure communication</li>
<li>Configure firewall rules for charger access</li>
<li>Set up monitoring and logging</li>
</ul>
<hr>
<h2 id="%F0%9F%94%90-security-features">ğŸ” Security Features</h2>
<ul>
<li>WebSocket connection validation</li>
<li>Charger ID-based session management</li>
<li>Transaction ID verification</li>
<li>Error handling and recovery</li>
<li>Automatic reconnection logic</li>
</ul>
<hr>
<h2 id="%F0%9F%93%9D-future-enhancements">ğŸ“ Future Enhancements</h2>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0">User authentication and authorization</label></li>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1">Multi-site support</label></li>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2">Mobile app integration</label></li>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3">Advanced scheduling (calendar-based)</label></li>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4">Cost optimization algorithms</label></li>
<li><input type="checkbox" id="checkbox5"><label for="checkbox5">Integration with energy tariff APIs</label></li>
<li><input type="checkbox" id="checkbox6"><label for="checkbox6">Push notifications for session events</label></li>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7">Export reports (PDF, CSV)</label></li>
</ul>
<hr>
<h2 id="%F0%9F%8E%93-learning-outcomes">ğŸ“ Learning Outcomes</h2>
<p>This project demonstrates:</p>
<ul>
<li>Real-time bidirectional communication (WebSocket)</li>
<li>Protocol implementation (OCPP 1.6)</li>
<li>Complex state management</li>
<li>Database integration and querying</li>
<li>Responsive web design</li>
<li>Algorithm design (DLB logic)</li>
<li>System architecture and design patterns</li>
<li>Testing and simulation strategies</li>
</ul>
<hr>
<h2 id="%F0%9F%93%9E-project-stats">ğŸ“ Project Stats</h2>
<ul>
<li><strong>Lines of Code</strong>: ~3,500+</li>
<li><strong>Files</strong>: 4 main files (server.js, dashboard.html, database.js, charger-simulator.js)</li>
<li><strong>Supported Chargers</strong>: Unlimited (scalable)</li>
<li><strong>Real-time Updates</strong>: Every 10 seconds</li>
<li><strong>Database</strong>: MongoDB with session persistence</li>
<li><strong>Timezone</strong>: IST (UTC+5:30) support</li>
</ul>
<hr>
<h2 id="%F0%9F%8F%86-key-achievements">ğŸ† Key Achievements</h2>
<p>âœ… Full OCPP 1.6 protocol implementation<br>
âœ… 4 intelligent DLB modes with real-time switching<br>
âœ… Bidirectional power flow visualization<br>
âœ… Multi-charger support with independent control<br>
âœ… Session history with timezone-aware timestamps<br>
âœ… Automated testing with realistic simulator<br>
âœ… 100% test pass rate for DLB toggles<br>
âœ… Responsive, modern web dashboard</p>
<hr>
<h2 id="%F0%9F%92%A1-innovation-highlights">ğŸ’¡ Innovation Highlights</h2>
<ol>
<li><strong>Bidirectional Grid Animation</strong>: Visual representation of import/export with direction-aware animated dots</li>
<li><strong>Real-Time DLB Sync</strong>: All dashboards update instantly when modes change</li>
<li><strong>Solar-Aware Charging</strong>: Intelligent power adjustment based on PV generation</li>
<li><strong>Safety-First Design</strong>: Anti Overload mode prevents electrical hazards</li>
<li><strong>IST Timezone Support</strong>: Localized timestamps for Indian deployment</li>
</ol>

</body>
</html>
