<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AV Charger App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/dashboard.css">

</head>

<body>

    <!-- Connection Status Banner -->
    <div class="connection-banner" id="connection-banner">
        <span class="connection-banner-icon">‚ö†Ô∏è</span>
        <span>Connection lost! Please refresh the page to reconnect.</span>
        <button class="refresh-btn" onclick="location.reload()">Refresh Now</button>
    </div>

    <div class="app-container">

        <div id="emptyState">
            <svg class="empty-box-icon" viewBox="0 0 24 24">
                <path fill="currentColor"
                    d="M20,6H16V4A2,2 0 0,0 14,2H10A2,2 0 0,0 8,4V6H4C2.89,6 2,6.89 2,8V19A2,2 0 0,0 4,21H20A2,2 0 0,0 22,19V8C22,6.89 21.1,6 20,6M10,4H14V6H10V4M20,19H4V8H20V19Z" />
            </svg>
            <div class="empty-text">Please Add Device</div>
        </div>

        <div id="listView">
            <div class="header-bar">
                <div class="header-title">Device List</div>
                <div style="font-size: 28px; cursor: pointer;">+</div>
            </div>
            <div id="charger-list-container">
                <!-- Chargers will be injected here dynamically -->
                <div class="empty-text" style="text-align:center; padding: 40px; color: #9ca3af;">
                    Searching for chargers...
                </div>
            </div>
        </div>

        <div id="detailView">
            <div class="detail-header">
                <button class="back-btn" onclick="goToScreen('list')">‚Üê</button>
                <div style="font-weight: 700; font-size: 18px;" id="detail-title">Charger 01</div>
                <div style="width: 24px;"></div>
            </div>
            <div class="gauge-section">
                <div class="liquid-circle">
                    <div class="wave" id="wave-fill"></div>
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 5px; z-index: 2; font-weight: 600;"
                        id="gauge-status-text">Unplugged</div>
                    <div class="gauge-value"><span id="power-big">0.00</span><span class="gauge-unit">kW</span></div>
                    <div style="font-size: 14px; color: #6b7280; margin-top: 5px; z-index: 2; font-weight: 500;"
                        id="charging-time">0h 0m
                    </div>
                </div>
                <div class="timer-btn" onclick="openTimerModal()">‚è± Charging Timer ></div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-bg-teal"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M16 18H8V6h8m0-2H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-7 10h6v2H9v-2zm0-4h6v2H9v-2zm0-4h6v2H9V8z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="energy-val">0</span><span
                            class="stat-label">Energy (kWh)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-blue"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M9 2v4H7v2h10V6h-2V2H9zm6 6H9v14h6V8zm-4 12h2v-2h-2v2zm0-4h2v-2h-2v2zm0-4h2v-2h-2v2z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="power-val">0</span><span class="stat-label">Power
                            (W)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-green"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M3.5 18.5l9-15 9 15H3.5zm8-2.5h2v-2h-2v2zm0-4h2V8h-2v4z" />
                            <path d="M2 20h20v2H2v-2z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="current-val">0</span><span
                            class="stat-label">Current (A)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-blue"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="voltage-val">0</span><span
                            class="stat-label">Voltage (V)</span></div>
                </div>
            </div>
            <div class="action-btn-container">
                <button class="start-btn" id="main-btn" onclick="toggleCharging()">Start Charging</button>
            </div>
        </div>

        <!-- Timer Modal -->
        <div class="modal-overlay" id="timer-modal-overlay">
            <div class="timer-modal">
                <div class="modal-header">
                    <div class="modal-title">Charging Timer</div>
                    <div class="modal-close" onclick="closeTimerModal()">√ó</div>
                </div>

                <div class="mode-toggle">
                    <div class="mode-option active" id="mode-duration" onclick="switchTimerMode('duration')">Duration
                    </div>
                    <div class="mode-option" id="mode-schedule" onclick="switchTimerMode('schedule')">Schedule</div>
                </div>

                <!-- Duration Mode -->
                <div class="timer-section active" id="duration-section">
                    <div class="input-group">
                        <label class="input-label">Charge for (minutes)</label>
                        <input type="number" class="timer-input" id="duration-input" placeholder="30" min="1">
                    </div>
                </div>

                <!-- Schedule Mode -->
                <div class="timer-section" id="schedule-section">
                    <div class="input-group">
                        <label class="input-label">Start Time (24-hour)</label>
                        <input type="time" class="timer-input" id="start-time-input">
                    </div>
                    <div class="input-group">
                        <label class="input-label">End Time (24-hour)</label>
                        <input type="time" class="timer-input" id="end-time-input">
                    </div>
                </div>

                <!-- Timer Status -->
                <div class="timer-status" id="timer-status" style="display: none;">
                    <div class="timer-status-text" id="timer-status-text">No active timer</div>
                </div>

                <!-- Actions -->
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-cancel" onclick="cancelTimer()">Cancel Timer</button>
                    <button class="modal-btn modal-btn-set" onclick="setTimer()">Set Timer</button>
                </div>
            </div>
        </div>

        <div id="historyView" style="display: none;">
            <div id="history-selector">
                <div class="detail-header">
                    <button class="back-btn" onclick="goToScreen('list')">‚Üê</button>
                    <div style="font-weight: 700; font-size: 18px;">Select Charger History</div>
                    <div style="width: 24px;"></div>
                </div>
                <div class="device-list" id="history-charger-list" style="margin-top: 20px;">
                    <!-- Charger list for history selection -->
                </div>
            </div>

            <div id="history-stats" style="display: none;">
                <div class="detail-header">
                    <button class="back-btn" onclick="backToHistorySelection()">‚Üê</button>
                    <div style="font-weight: 700; font-size: 18px;" id="history-title">History</div>
                    <div style="width: 24px;"></div>
                </div>
                <div class="history-toggle">
                    <div class="toggle-opt active" onclick="switchView('month')">Month</div>
                    <div class="toggle-opt" onclick="switchView('year')">Year</div>
                </div>
                <div class="date-nav" id="date-nav-container">
                    <div class="date-arrow" onclick="changePeriod(-1)">&lt;</div>
                    <label class="date-label-wrapper" onclick="openPicker()">
                        <span class="date-display" id="displayPeriod">2026-01</span>
                        <input type="month" id="periodPicker" class="date-input-hidden"
                            onchange="updateHistoryData(this.value)">
                    </label>
                    <div class="date-arrow" onclick="changePeriod(1)">&gt;</div>
                </div>
                <div class="history-summary-card">
                    <div class="history-total" id="totalUsage">0.00 kW¬∑h</div>
                    <div class="history-label" id="usage-label">Total Monthly Usage</div>
                </div>
                <div class="chart-container" id="chart-container">
                    <!-- Chart bars will be dynamically generated -->
                </div>
                <div class="daily-breakdown-section">
                    <div class="daily-breakdown-title">
                        <svg style="width: 20px; height: 20px; margin-right: 8px; color: #667eea;" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z" />
                        </svg>
                        Daily Breakdown
                    </div>
                    <div id="daily-usage-list">
                        <!-- Daily list items will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="dlbView" style="display: none;">
            <div class="header-bar">
                <div class="header-title">Dynamic Load Balance</div>
            </div>

            <div id="dlb-offline-overlay"
                style="display: none; padding: 60px 20px; text-align: center; animation: fadeIn 0.5s ease;">
                <div
                    style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                    <svg viewBox="0 0 24 24" style="width: 40px; color: #ef4444;">
                        <path fill="currentColor"
                            d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z" />
                    </svg>
                </div>
                <h3 style="margin-bottom: 8px; color: #1f2937;">Charger Offline</h3>
                <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">No active connection between server and
                    charger. Dynamic Load Balance is currently unavailable.</p>
                <button class="modal-btn modal-btn-set" style="max-width: 200px;" onclick="goToScreen('list')">Go to
                    Device List</button>
            </div>

            <div id="dlb-content">
                <!-- Hub and Spoke Visualization -->
                <div class="hub-viz-container">
                    <div class="hub-viz-inner">
                        <!-- SVG Paths Layer -->
                        <svg class="hub-svg-layer" viewBox="0 0 400 480">
                            <!-- S-Curved paths from spoke nodes to hub -->
                            <!-- Path Grid -> Hub -->
                            <path id="path-grid" class="power-path path-grid" d="M 90 145 C 90 195, 185 150, 185 190" />
                            <!-- Path PV -> Hub -->
                            <path id="path-pv" class="power-path path-pv" d="M 310 145 C 310 195, 215 150, 215 190" />
                            <!-- Path Hub -> Charger -->
                            <path id="path-charger" class="power-path path-charger"
                                d="M 185 290 C 185 330, 90 285, 90 335" />
                            <!-- Path Hub -> Home -->
                            <path id="path-home" class="power-path path-home"
                                d="M 215 290 C 215 330, 310 285, 310 335" />

                            <!-- Flow Dots -->
                            <!-- Grid Import: Grid -> Hub (positive gridPower) -->
                            <circle id="dot-grid-import" class="flow-dot dot-grid" r="5">
                                <animateMotion id="anim-grid-import" dur="2s" repeatCount="indefinite"
                                    path="M 90 145 C 90 195, 185 150, 185 190" />
                            </circle>
                            <!-- Grid Export: Hub -> Grid (negative gridPower) -->
                            <circle id="dot-grid-export" class="flow-dot dot-grid" r="5">
                                <animateMotion id="anim-grid-export" dur="2s" repeatCount="indefinite"
                                    path="M 185 190 C 185 150, 90 195, 90 145" />
                            </circle>
                            <circle id="dot-pv" class="flow-dot dot-pv" r="5">
                                <animateMotion id="anim-pv" dur="2s" repeatCount="indefinite"
                                    path="M 310 145 C 310 195, 215 150, 215 190" />
                            </circle>
                            <circle id="dot-charger" class="flow-dot dot-charger" r="5">
                                <animateMotion id="anim-charger" dur="2s" repeatCount="indefinite"
                                    path="M 185 290 C 185 330, 90 285, 90 335" />
                            </circle>
                            <circle id="dot-home" class="flow-dot dot-home" r="5">
                                <animateMotion id="anim-home" dur="2s" repeatCount="indefinite"
                                    path="M 215 290 C 215 330, 310 285, 310 335" />
                            </circle>
                        </svg>

                        <!-- Center Node: Smart logic hub -->
                        <div class="hub-node hub-node-center">
                            <div class="hub-icon-box" style="color: #6366f1;">
                                <svg viewBox="0 0 24 24" style="width: 44px; height: 44px;">
                                    <path fill="currentColor"
                                        d="M15,9H9V15H15V9M13,13H11V11H13V13M15,1H9V5H15V1M19,5H5V19H19V5M21,11V9H23V11H21M21,15V13H23V15H21M21,7V5H23V7H21M21,19V17H23V19H21M3,11V9H1V11H3M3,15V13H1V15H3M3,7V5H1V7H3M3,19V17H1V19H3M15,23V19H9V23H15Z" />
                                </svg>
                            </div>
                        </div>

                        <!-- Top Left: Grid (Pylon) -->
                        <div class="hub-node hub-node-tl">
                            <div class="hub-icon-box" style="color: #6366f1;">
                                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;">
                                    <path fill="currentColor"
                                        d="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z" />
                                </svg>
                            </div>
                            <div class="hub-val" id="dlb-grid-power">0.00kW</div>
                            <div class="hub-label">Grid load</div>
                        </div>

                        <!-- Top Right: Solar PV (Solar Panel) -->
                        <div class="hub-node hub-node-tr">
                            <div class="hub-icon-box" style="color: #f59e0b;">
                                <svg viewBox="0 0 24 24" style="width: 36px; height: 36px;">
                                    <path fill="currentColor"
                                        d="M4,4V17H20V4H4M6,6H10V10H6V6M14,6H18V10H14V6M6,11H10V15H6V11M14,11H18V15H14V11M12,19V22H13V19H12M15,19V22H16V19H15M9,19V22H10V19H9" />
                                </svg>
                            </div>
                            <div class="hub-val" id="dlb-pv-power">0.00kW</div>
                            <div class="hub-label">Solar PV</div>
                        </div>

                        <!-- Bottom Left: Charger (EV Pump) -->
                        <div class="hub-node hub-node-bl">
                            <div class="hub-icon-box" style="color: #10b981;">
                                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;">
                                    <path fill="currentColor"
                                        d="M21,7V3H19V7H15V11H19V21H21V11H23V7H21M17,11V9H3V11H4V18H3V20H17V18H16V11H17M14,18H6V11H14V18Z" />
                                </svg>
                            </div>
                            <div class="hub-val" id="dlb-charger-power">0.00kW</div>
                            <div class="hub-label">Charger</div>
                        </div>

                        <!-- Bottom Right: Home Load (Home Heart) -->
                        <div class="hub-node hub-node-br">
                            <div class="hub-icon-box" style="color: #06b6d4;">
                                <svg viewBox="0 0 24 24" style="width: 32px; height: 32px;">
                                    <path fill="currentColor" d="M12,3L2,12H5V20H19V12H22L12,3Z" />
                                </svg>
                            </div>
                            <div class="hub-val" id="dlb-home-power">0.00kW</div>
                            <div class="hub-label">Home load</div>
                        </div>
                    </div>
                </div>

                <!-- Modes -->
                <div class="dlb-controls">
                    <div class="control-item">
                        <div class="control-info">
                            <div class="control-text">
                                <h4>PV Dynamic Balance</h4>
                                <p>Prioritize solar power consumption</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dlb-pv-balance"
                                onchange="updateDLBMode('pvDynamicBalance', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="control-item">
                        <div class="control-info">
                            <div class="control-text">
                                <h4>Extreme Mode</h4>
                                <p>Maximum power charging</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dlb-extreme-mode"
                                onchange="updateDLBMode('extremeMode', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="control-item">
                        <div class="control-info">
                            <div class="control-text">
                                <h4>Night Full Speed</h4>
                                <p>Full speed charging at night</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dlb-night-mode"
                                onchange="updateDLBMode('nightFullSpeed', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="control-item">
                        <div class="control-info">
                            <div class="control-text">
                                <h4>Anti Overload</h4>
                                <p>Prevent exceeding grid capacity</p>
                            </div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dlb-anti-overload"
                                onchange="updateDLBMode('antiOverload', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="goToScreen('list')">
                <svg viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg><span>Home</span>
            </div>
            <div class="nav-item" id="nav-history" onclick="goToScreen('history')">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
                </svg><span>History</span>
            </div>
            <div class="nav-item" id="nav-dlb" onclick="goToScreen('dlb')">
                <svg viewBox="0 0 24 24">
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
                </svg><span>DLB</span>
            </div>
            <div class="nav-item" id="nav-setting" onclick="goToScreen('setting')">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                </svg><span>Setting</span>
            </div>
        </div>

        <div id="settingView" style="display: none; background: #fff; min-height: 100vh;">
            <div class="header-bar">
                <div class="header-title">Settings</div>
            </div>

            <div style="padding: 20px;">
                <!-- Power Limit Section -->
                <div class="dlb-controls" style="margin-bottom: 20px;">
                    <h3 style="margin: 0 0 20px 0; font-size: 18px; color: #1f2937; font-weight: 700;">
                        ‚ö° Power Limiting
                    </h3>

                    <div style="margin-bottom: 24px;">
                        <label
                            style="display: block; font-size: 14px; color: #6b7280; margin-bottom: 12px; font-weight: 600;">
                            Maximum Charging Current
                        </label>

                        <!-- Current Value Display -->
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div
                                style="font-size: 48px; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                <span id="power-limit-display">32</span>A
                            </div>
                            <div style="font-size: 13px; color: #6b7280; margin-top: 8px; font-weight: 600;">
                                Current Limit
                            </div>
                        </div>

                        <!-- Range Slider -->
                        <div style="margin-bottom: 20px;">
                            <input type="range" id="power-limit-slider" min="6" max="32" value="32" step="1"
                                style="width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); outline: none; -webkit-appearance: none; appearance: none;"
                                oninput="updatePowerLimitDisplay(this.value)">
                        </div>

                        <!-- Min/Max Labels -->
                        <div
                            style="display: flex; justify-content: space-between; font-size: 12px; color: #9ca3af; margin-bottom: 20px;">
                            <span>6A (Min)</span>
                            <span>32A (Max)</span>
                        </div>

                        <!-- Numeric Input -->
                        <div style="margin-bottom: 20px;">
                            <label
                                style="display: block; font-size: 13px; color: #6b7280; margin-bottom: 8px; font-weight: 600;">
                                Or enter value manually:
                            </label>
                            <input type="number" id="power-limit-input" min="6" max="32" value="32"
                                style="width: 100%; padding: 12px; border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 12px; font-size: 16px; font-weight: 600; text-align: center; background: rgba(102, 126, 234, 0.05);"
                                oninput="updatePowerLimitFromInput(this.value)">
                        </div>

                        <!-- Info Box -->
                        <div
                            style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: 12px; padding: 16px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                            <div style="font-size: 13px; color: #4b5563; line-height: 1.6;">
                                <strong>‚ÑπÔ∏è Note:</strong> This setting limits the maximum charging current for all
                                chargers.
                                The actual charging current may be lower based on DLB modes and available power.
                            </div>
                        </div>

                        <!-- Save Button -->
                        <button onclick="savePowerLimit()"
                            style="width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
                            üíæ Save Power Limit
                        </button>

                        <!-- Status Message -->
                        <div id="power-limit-status"
                            style="margin-top: 16px; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; text-align: center; display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History View -->
        <div id="historyView" style="display: none; background: #fff; min-height: 100vh;">
            <div class="header-bar">
                <div class="header-title">Charging History</div>
            </div>

            <div style="padding: 20px;">
                <!-- Charger Selection -->
                <div id="history-charger-selection" style="margin-bottom: 20px;">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; color: #1f2937; font-weight: 700;">
                        Select Charger
                    </h3>
                    <div id="history-charger-list" style="display: grid; gap: 12px;">
                        <!-- Charger cards will be inserted here -->
                    </div>
                </div>

                <!-- Session List -->
                <div id="history-session-list" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0; font-size: 18px; color: #1f2937; font-weight: 700;">
                            <span id="history-charger-name"></span> Sessions
                        </h3>
                        <button onclick="showChargerSelection()"
                            style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ‚Üê Back
                        </button>
                    </div>

                    <!-- Period Selector -->
                    <div
                        style="display: flex; gap: 8px; margin-bottom: 16px; background: #f9fafb; padding: 8px; border-radius: 12px;">
                        <button onclick="changeHistoryPeriod('day')" id="period-day"
                            style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            Daily
                        </button>
                        <button onclick="changeHistoryPeriod('week')" id="period-week"
                            style="flex: 1; padding: 10px; background: #e5e7eb; color: #6b7280; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            Weekly
                        </button>
                        <button onclick="changeHistoryPeriod('month')" id="period-month"
                            style="flex: 1; padding: 10px; background: #e5e7eb; color: #6b7280; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            Monthly
                        </button>
                    </div>

                    <div
                        style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); 
                                padding: 16px; border-radius: 12px; margin-bottom: 20px; border: 2px solid rgba(102, 126, 234, 0.2);">
                        <div style="font-size: 14px; color: #6b7280; margin-bottom: 4px;">Total Energy</div>
                        <div
                            style="font-size: 32px; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); 
                                    background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            <span id="history-total-energy">0</span> kWh
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div
                        style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e5e7eb;">
                        <h4 style="margin: 0 0 16px 0; font-size: 16px; color: #1f2937; font-weight: 700;">
                            Energy Usage Chart
                        </h4>
                        <div id="history-chart" style="height: 250px; position: relative;">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>

                    <h4 style="margin: 0 0 12px 0; font-size: 16px; color: #1f2937; font-weight: 700;">
                        All Sessions
                    </h4>
                    <div id="history-sessions-container">
                        <!-- Session cards will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

    </div>

<script src="/js/dashboard.js"></script>
</body>
</html>
