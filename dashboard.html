<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LECO Charger App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- RESET & BASICS --- */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: relative;
            padding-bottom: 80px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        /* Responsive: Limit width on larger screens for better readability */
        @media (min-width: 768px) {
            .app-container {
                max-width: 1200px;
            }
        }

        /* --- ICONS --- */
        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
            transition: all 0.3s ease;
        }

        .icon-blue {
            color: #667eea;
        }

        .icon-green {
            color: #10b981;
        }

        .icon-teal {
            color: #06b6d4;
        }

        /* --- HEADER --- */
        .header-bar {
            padding: 24px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .header-title {
            font-size: 22px;
            font-weight: 800;
            color: white;
            letter-spacing: -0.5px;
        }

        /* --- SCREEN 0: EMPTY STATE --- */
        #emptyState {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh;
            text-align: center;
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .empty-box-icon {
            width: 120px;
            height: 120px;
            opacity: 0.3;
            margin-bottom: 20px;
            color: #667eea;
        }

        .empty-text {
            font-size: 16px;
            color: #9ca3af;
            font-weight: 500;
        }

        /* --- SCREEN 1: DEVICE LIST --- */
        #listView {
            padding: 20px;
            display: none;
        }

        .device-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            position: relative;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.5);
            animation: popIn 0.5s ease;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .device-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.25);
        }

        @keyframes popIn {
            from {
                transform: scale(0.95) translateY(10px);
                opacity: 0;
            }

            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .device-icon-box {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .device-icon-box:hover {
            transform: rotate(5deg) scale(1.05);
        }

        .device-icon-box .icon {
            color: white;
            width: 28px;
            height: 28px;
        }

        .device-info h3 {
            margin: 0 0 5px 0;
            font-size: 17px;
            color: #1a1a1a;
            font-weight: 700;
        }

        .device-info p {
            margin: 0;
            font-size: 13px;
            color: #6b7280;
        }

        .status-badge {
            margin-top: 10px;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .menu-dots {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #9ca3af;
            font-size: 22px;
            padding: 5px;
            z-index: 5;
            cursor: pointer;
            transition: color 0.3s;
        }

        .menu-dots:hover {
            color: #667eea;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 20px;
            top: 45px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 100;
            overflow: hidden;
            width: 130px;
        }

        .dropdown-item {
            padding: 14px 16px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #f3f4f6;
        }

        .text-red {
            color: #ef4444;
        }

        /* --- SCREEN 2: MONITOR DASHBOARD --- */
        #detailView {
            display: none;
            background: #fff;
            min-height: 100vh;
        }

        .detail-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-2px);
        }

        .gauge-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
            margin-bottom: 40px;
        }

        .liquid-circle {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            border: 6px solid transparent;
            background: linear-gradient(white, white) padding-box,
                linear-gradient(135deg, #667eea, #764ba2) border-box;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.25);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: translateY(100%);
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
            opacity: 0.15;
        }

        .wave::after {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            top: -150%;
            left: -50%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-radius: 40%;
            animation: ripple 8s linear infinite;
        }

        @keyframes ripple {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .gauge-value {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            z-index: 2;
        }

        .gauge-unit {
            font-size: 18px;
            font-weight: 600;
        }

        .timer-btn {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 10px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 30px;
            margin-top: 24px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            padding: 0 20px;
            margin-bottom: 140px;
        }

        /* Desktop: 4 columns for stats */
        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                padding: 0 40px;
            }
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 251, 0.9));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.08);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            transition: transform 0.3s ease;
        }

        .stat-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .stat-bg-blue {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-bg-blue .icon {
            color: white;
        }

        .stat-bg-green {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .stat-bg-green .icon {
            color: white;
        }

        .stat-bg-teal {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .stat-bg-teal .icon {
            color: white;
        }

        .stat-val {
            display: block;
            font-size: 18px;
            font-weight: 800;
            color: #1f2937;
            letter-spacing: -0.5px;
        }

        .stat-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .action-btn-container {
            position: fixed;
            bottom: 90px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: center;
            z-index: 50;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 100%;
            max-width: 440px;
            padding: 18px;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.5px;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);
        }

        .start-btn.active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
        }

        .start-btn.active:hover {
            box-shadow: 0 12px 32px rgba(239, 68, 68, 0.5);
        }

        /* --- SCREEN 3: HISTORY VIEW --- */
        #historyView {
            display: none;
            padding: 20px;
            background: #fff;
            min-height: 100vh;
        }

        .history-toggle {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 12px;
            padding: 6px;
            display: flex;
            margin-bottom: 24px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .toggle-opt {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .toggle-opt.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .date-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
        }

        .date-arrow {
            color: #667eea;
            font-size: 28px;
            padding: 10px 20px;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .date-arrow:hover {
            color: #764ba2;
            transform: scale(1.2);
        }

        .date-label-wrapper {
            position: relative;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 12px 28px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .date-label-wrapper:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border-color: rgba(102, 126, 234, 0.4);
        }

        .date-display {
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-input-hidden {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .history-summary-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 24px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 48px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.1);
        }

        .history-total {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .history-label {
            font-size: 13px;
            color: #6b7280;
            margin-top: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-container {
            height: 280px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 0 10px;
            position: relative;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
            margin-bottom: 20px;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 10%;
        }

        .bar {
            width: 16px;
            background: linear-gradient(180deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-radius: 8px 8px 0 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bar.highlight {
            background: linear-gradient(180deg, #667eea, #764ba2);
            box-shadow: 0 -4px 16px rgba(102, 126, 234, 0.4);
        }

        .bar-label {
            font-size: 11px;
            color: #6b7280;
            margin-top: 10px;
            font-weight: 600;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 75px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(102, 126, 234, 0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 10px;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(102, 126, 234, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #9ca3af;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-item:hover {
            transform: translateY(-2px);
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-item svg {
            width: 26px;
            height: 26px;
            margin-bottom: 4px;
            fill: currentColor;
            transition: all 0.3s ease;
        }

        .nav-item.active svg {
            transform: scale(1.1);
        }
    </style>
</head>

<body>

    <div class="app-container">

        <div id="emptyState">
            <svg class="empty-box-icon" viewBox="0 0 24 24">
                <path fill="currentColor"
                    d="M20,6H16V4A2,2 0 0,0 14,2H10A2,2 0 0,0 8,4V6H4C2.89,6 2,6.89 2,8V19A2,2 0 0,0 4,21H20A2,2 0 0,0 22,19V8C22,6.89 21.1,6 20,6M10,4H14V6H10V4M20,19H4V8H20V19Z" />
            </svg>
            <div class="empty-text">Please Add Device</div>
        </div>

        <div id="listView">
            <div class="header-bar">
                <div class="header-title">Device List</div>
                <div style="font-size: 28px; cursor: pointer;">+</div>
            </div>
            <div class="device-card" id="card-1">
                <div class="device-icon-box" onclick="goToScreen('detail')">
                    <svg class="icon icon-blue" viewBox="0 0 24 24">
                        <path d="M13 2L3 14h9v8l10-12h-9z" />
                    </svg>
                </div>
                <div class="device-info" onclick="goToScreen('detail')">
                    <h3 id="list-name">Charger 01</h3>
                    <p>ID: <span id="list-id">Waiting...</span></p>
                    <div class="status-badge">
                        <span id="list-status">Offline</span>
                        <svg class="icon" style="width:16px;" viewBox="0 0 24 24">
                            <path
                                d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" />
                        </svg>
                    </div>
                </div>
                <div class="menu-dots" onclick="toggleMenu('menu-1')">‚Ä¢‚Ä¢‚Ä¢</div>
                <div id="menu-1" class="dropdown-menu">
                    <div class="dropdown-item" onclick="renameDevice()">Rename</div>
                    <div class="dropdown-item text-red" onclick="deleteDevice()">Delete</div>
                </div>
            </div>
        </div>

        <div id="detailView">
            <div class="detail-header">
                <button class="back-btn" onclick="goToScreen('list')">‚Üê</button>
                <div style="font-weight: 700; font-size: 18px;" id="detail-title">Charger 01</div>
                <div style="width: 24px;"></div>
            </div>
            <div class="gauge-section">
                <div class="liquid-circle">
                    <div class="wave" id="wave-fill"></div>
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 5px; z-index: 2; font-weight: 600;"
                        id="gauge-status-text">Unplugged</div>
                    <div class="gauge-value"><span id="power-big">0.00</span><span class="gauge-unit">kW</span></div>
                    <div style="font-size: 14px; color: #6b7280; margin-top: 5px; z-index: 2; font-weight: 500;">0h0m
                    </div>
                </div>
                <div class="timer-btn">‚è± Charging Timer ></div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-bg-teal"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zM11 20v-5.5H9L13 7v5.5h2L11 20z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="energy-val">0</span><span
                            class="stat-label">Energy (kWh)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-blue"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="power-val">0</span><span class="stat-label">Power
                            (W)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-green"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="current-val">0</span><span
                            class="stat-label">Current (A)</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-bg-blue"><svg class="icon" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                        </svg></div>
                    <div class="stat-info"><span class="stat-val" id="voltage-val">0</span><span
                            class="stat-label">Voltage (V)</span></div>
                </div>
            </div>
            <div class="action-btn-container">
                <button class="start-btn" id="main-btn" onclick="toggleCharging()">Start Charging</button>
            </div>
        </div>

        <div id="historyView">
            <div class="detail-header">
                <button class="back-btn" onclick="goToScreen('list')">‚Üê</button>
                <div style="font-weight: 700; font-size: 18px;" id="history-title">Charger 01</div>
                <div class="icon" style="width: 24px;"></div>
            </div>
            <div class="history-toggle">
                <div class="toggle-opt active" onclick="switchView('month')">Month</div>
                <div class="toggle-opt" onclick="switchView('year')">Year</div>
            </div>
            <div class="date-nav" id="date-nav-container">
                <div class="date-arrow" onclick="changePeriod(-1)">&lt;</div>
                <label class="date-label-wrapper" onclick="openPicker()">
                    <span class="date-display" id="displayPeriod">2026-01</span>
                    <input type="month" id="periodPicker" class="date-input-hidden"
                        onchange="updateHistoryData(this.value)">
                </label>
                <div class="date-arrow" onclick="changePeriod(1)">&gt;</div>
            </div>
            <div class="history-summary-card">
                <div class="history-total" id="totalUsage">0.00 kW¬∑h</div>
                <div class="history-label" id="usage-label">Total Monthly Usage</div>
            </div>
            <div class="chart-container" id="chart-container">
                <!-- Chart bars will be dynamically generated -->
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="goToScreen('detail')">
                <svg viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg><span>Home</span>
            </div>
            <div class="nav-item" id="nav-history" onclick="goToScreen('history')">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" />
                </svg><span>History</span>
            </div>
            <div class="nav-item">
                <svg viewBox="0 0 24 24">
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
                </svg><span>DLB</span>
            </div>
            <div class="nav-item">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                </svg><span>Setting</span>
            </div>
        </div>

    </div>

    <script>
        // --- APP LOGIC ---

        function goToScreen(screenName) {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('listView').style.display = 'none';
            document.getElementById('detailView').style.display = 'none';
            document.getElementById('historyView').style.display = 'none';

            // Reset Nav
            document.getElementById('nav-home').classList.remove('active');
            document.getElementById('nav-history').classList.remove('active');

            if (screenName === 'empty') {
                document.getElementById('emptyState').style.display = 'flex';
            }
            else if (screenName === 'list') {
                document.getElementById('listView').style.display = 'block';
                document.getElementById('nav-home').classList.add('active');
            }
            else if (screenName === 'detail') {
                document.getElementById('detailView').style.display = 'block';
                document.getElementById('nav-home').classList.add('active');
            }
            else if (screenName === 'history') {
                document.getElementById('historyView').style.display = 'block';
                document.getElementById('nav-history').classList.add('active');
                const picker = document.getElementById('periodPicker');
                if (picker && !picker.value) {
                    const now = new Date();
                    const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
                    picker.value = currentMonth;
                    currentPeriod = currentMonth;
                    updateHistoryData(currentMonth);
                }
            }
        }

        // --- RENAME LOGIC (UPDATED) ---
        function toggleMenu(menuId) {
            event.stopPropagation();
            var menu = document.getElementById(menuId);
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        }
        window.onclick = function (event) {
            if (!event.target.matches('.menu-dots')) {
                var dropdowns = document.getElementsByClassName("dropdown-menu");
                for (var i = 0; i < dropdowns.length; i++) { dropdowns[i].style.display = "none"; }
            }
        }

        // *** NEW: Rename Function Updates All 3 Screens ***
        function renameDevice() {
            let currentName = document.getElementById('list-name').innerText;
            let newName = prompt("Rename Device:", currentName);
            if (newName) {
                document.getElementById('list-name').innerText = newName;   // Update List
                document.getElementById('detail-title').innerText = newName; // Update Detail Header
                document.getElementById('history-title').innerText = newName; // Update History Header
            }
        }

        function deleteDevice() { if (confirm("Delete?")) goToScreen('empty'); }

        // --- WEBSOCKET CONNECTION ---
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = protocol + '//' + window.location.host + '/dashboard-ui';
        const ws = new WebSocket(wsUrl);

        let isCharging = false;

        ws.onopen = () => {
            console.log('‚úÖ Dashboard connected to server');
        };

        ws.onerror = (error) => {
            console.error('‚ùå WebSocket error:', error);
        };

        ws.onclose = () => {
            console.log('üîå Dashboard disconnected from server');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // 1. CONNECTION DETECTED!
            if (data.type === 'status') {
                const statusEl = document.getElementById('list-status');
                statusEl.innerText = data.status;
                document.getElementById('list-id').innerText = data.id;

                if (data.status === 'Online') {
                    statusEl.style.color = '#10b981';

                    // Auto-Switch to Detail View when device connects!
                    if (document.getElementById('emptyState').style.display !== 'none') {
                        goToScreen('detail');
                    }

                    if (!isCharging) document.getElementById('wave-fill').style.transform = "translateY(80%)";
                } else {
                    statusEl.style.color = '#6b7280';
                }
            }

            // 2. METER DATA
            if (data.type === 'meter') {
                document.getElementById('voltage-val').innerText = data.voltage;
                document.getElementById('current-val').innerText = data.current;
                document.getElementById('power-val').innerText = data.power;
                document.getElementById('power-big').innerText = (data.power / 1000).toFixed(2);
            }
        };

        // --- HISTORY VIEW FUNCTIONS ---
        let currentViewType = 'month'; // 'month' or 'year'
        let currentPeriod = '2026-01'; // YYYY-MM or YYYY

        function switchView(viewType) {
            currentViewType = viewType;

            // Update toggle buttons
            document.querySelectorAll('.toggle-opt').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');

            // Update label and picker type
            const label = document.getElementById('usage-label');
            const picker = document.getElementById('periodPicker');

            if (viewType === 'month') {
                label.innerText = 'Total Monthly Usage';
                picker.type = 'month';
                currentPeriod = new Date().toISOString().substring(0, 7); // YYYY-MM
            } else {
                label.innerText = 'Total Yearly Usage';
                picker.type = 'number';
                picker.min = '2020';
                picker.max = '2030';
                currentPeriod = new Date().getFullYear().toString(); // YYYY
            }

            updateHistoryData(currentPeriod);
        }

        function openPicker() {
            const picker = document.getElementById('periodPicker');
            picker.showPicker ? picker.showPicker() : picker.click();
        }

        function changePeriod(step) {
            if (currentViewType === 'month') {
                // Change month
                let date = new Date(currentPeriod + "-01");
                date.setMonth(date.getMonth() + step);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                currentPeriod = `${year}-${month}`;
            } else {
                // Change year
                let year = parseInt(currentPeriod);
                year += step;
                currentPeriod = year.toString();
            }

            document.getElementById('periodPicker').value = currentPeriod;
            updateHistoryData(currentPeriod);
        }

        async function updateHistoryData(period) {
            currentPeriod = period;
            document.getElementById('displayPeriod').innerText = period;

            try {
                // Fetch real data from API
                const response = await fetch(`/api/history?period=${period}&type=${currentViewType}`);
                const data = await response.json();

                // Update total
                document.getElementById('totalUsage').innerText = data.totalEnergy + " kW¬∑h";

                // Render chart
                renderChart(data.chartData, currentViewType);
            } catch (error) {
                console.error('Error fetching history:', error);
                document.getElementById('totalUsage').innerText = "0.00 kW¬∑h";
                renderChart([], currentViewType);
            }
        }

        function renderChart(chartData, viewType) {
            const container = document.getElementById('chart-container');
            container.innerHTML = '';

            if (chartData.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af; font-size: 14px;">No data available for this period</div>';
                return;
            }

            // Find max value for scaling
            const maxEnergy = Math.max(...chartData.map(d => parseFloat(d.energy)), 1);

            // Determine number of bars to show
            const numBars = viewType === 'month' ? 31 : 12;

            // Create bars
            for (let i = 1; i <= numBars; i++) {
                const dataPoint = chartData.find(d => d.label === i);
                const energy = dataPoint ? parseFloat(dataPoint.energy) : 0;
                const height = energy > 0 ? Math.max((energy / maxEnergy) * 100, 5) : 0;

                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';

                const bar = document.createElement('div');
                bar.className = energy > 0 ? 'bar highlight' : 'bar';
                bar.style.height = height + '%';

                const label = document.createElement('span');
                label.className = 'bar-label';
                label.innerText = i;

                barGroup.appendChild(bar);
                barGroup.appendChild(label);
                container.appendChild(barGroup);
            }
        }

        // --- OTHER FUNCTIONS ---

        function toggleCharging() {
            const btn = document.getElementById('main-btn');
            const statusText = document.getElementById('gauge-status-text');
            const wave = document.getElementById('wave-fill');
            if (!isCharging) {
                ws.send(JSON.stringify({ action: "START" }));
                isCharging = true;
                btn.innerText = "Stop Charging"; btn.classList.add('active');
                statusText.innerText = "Requesting Start..."; statusText.style.color = "#f59e0b";
                wave.style.transform = "translateY(20%)"; wave.style.opacity = "0.8";
            } else {
                ws.send(JSON.stringify({ action: "STOP" }));
                isCharging = false;
                btn.innerText = "Start Charging"; btn.classList.remove('active');
                statusText.innerText = "Stopping..."; statusText.style.color = "#6b7280";
                wave.style.transform = "translateY(100%)";
            }
        }
    </script>

</body>

</html>